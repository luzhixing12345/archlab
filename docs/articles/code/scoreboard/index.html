<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        Document
    </title>
    <link rel='stylesheet' href=../../../css/index.css />
    <link rel='stylesheet' href=../../../css/python.css /><link rel='stylesheet' href=../../../css/riscvasm.css /><link rel='stylesheet' href=../../../css/shell.css />
    <link rel="icon" href="https://raw.githubusercontent.com/learner-lu/picbed/master/logo.png">
</head>

<body class="light">
    <a href="https://github.com/luzhixing12345/archlab.git" target="_blank" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <div class="header-navigator"><ul><li><a href="#h1-0">scoreboard</a><ul><li><a href="#h2-1">运行结果</a></li></ul><ul><li><a href="#h2-2">ScoreBoard 算法</a><ul><li><a href="#h3-3">背景</a></li></ul><ul><li><a href="#h3-4">算法流程</a><ul><li><a href="#h4-5">CLOCK 0</a></li></ul><ul><li><a href="#h4-6">CLOCK 1</a></li></ul><ul><li><a href="#h4-7">CLOCK 2</a></li></ul><ul><li><a href="#h4-8">CLOCK 3</a></li></ul><ul><li><a href="#h4-9">CLOCK 4</a></li></ul><ul><li><a href="#h4-10">CLOCK 5</a></li></ul><ul><li><a href="#h4-11">CLOCK 6</a></li></ul><ul><li><a href="#h4-12">CLOCK 7</a></li></ul><ul><li><a href="#h4-13">CLOCK 8</a></li></ul><ul><li><a href="#h4-14">CLOCK 17 & CLOCK 22</a></li></ul></li></ul></li></ul><ul><li><a href="#h2-15">实验报告</a><ul><li><a href="#h3-16">实验分析</a></li></ul><ul><li><a href="#h3-17">代码实现</a></li></ul></li></ul><ul><li><a href="#h2-18">参考</a></li></ul></li></ul></div><div class='markdown-body'><h1 id="h1-0">scoreboard</h1><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/luzhixing12345/archlab/main/img/homework4.png"><img src="https://raw.githubusercontent.com/luzhixing12345/archlab/main/img/homework4.png" alt="image"></a></p><h2 id="h2-1">运行结果</h2><blockquote><p>jupyter 提交版见 <a href="https://github.com/luzhixing12345/archlab/blob/main/src/homework4/main.ipynb" target="_blank">main.ipynb</a></p></blockquote><pre class="language-shell"><code><span class="Token Program ID">python</span><span class="Token SPACE"> </span><span class="Token PATH">src/homework4/main.py</span></code></pre><blockquote><p>输出结果很多, 仅展示部分内容(clock1 和 clock62 的输出), 完整内容见 <a href="https://github.com/luzhixing12345/archlab/blob/main/src/homework4/output.txt" target="_blank">output.txt</a></p></blockquote><pre class="language-shell"><code><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Program ID">instruction</span><span class="Token SPACE"> </span><span class="Token ID">status</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Op</span><span class="Token SPACE">   </span><span class="Token ID">dest</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token SPACE">   </span><span class="Token ID">k</span><span class="Token SPACE">  </span><span class="Token PIPE">|</span><span class="Token SPACE"> </span><span class="Token Program ID">Issue</span><span class="Token SPACE">  </span><span class="Token ID">Read</span><span class="Token SPACE">  </span><span class="Token ID">Exec</span><span class="Token SPACE">  </span><span class="Token ID">Write</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Load</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE">   </span><span class="Token NUMBER">34</span><span class="Token SPACE">  </span><span class="Token ID">R2</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Load</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE">   </span><span class="Token NUMBER">45</span><span class="Token SPACE">  </span><span class="Token ID">R3</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Mul</span><span class="Token SPACE">  </span><span class="Token ID">F0</span><span class="Token SPACE">   </span><span class="Token ID">F2</span><span class="Token SPACE">  </span><span class="Token ID">F4</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Sub</span><span class="Token SPACE">  </span><span class="Token ID">F8</span><span class="Token SPACE">   </span><span class="Token ID">F6</span><span class="Token SPACE">  </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Div</span><span class="Token SPACE">  </span><span class="Token ID">F10</span><span class="Token SPACE">  </span><span class="Token ID">F0</span><span class="Token SPACE">  </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Add</span><span class="Token SPACE">  </span><span class="Token ID">F6</span><span class="Token SPACE">   </span><span class="Token ID">F8</span><span class="Token SPACE">  </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Program ID">functional</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token ID">status</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Time</span><span class="Token SPACE">   </span><span class="Token ID">Name</span><span class="Token SPACE">    </span><span class="Token PIPE">|</span><span class="Token SPACE"> </span><span class="Token Program ID">Busy</span><span class="Token SPACE">  </span><span class="Token ID">Op</span><span class="Token SPACE">    </span><span class="Token ID">Fi</span><span class="Token SPACE">  </span><span class="Token ID">Fj</span><span class="Token SPACE">  </span><span class="Token ID">Fk</span><span class="Token SPACE">  </span><span class="Token ID">Qj</span><span class="Token SPACE">      </span><span class="Token ID">Qk</span><span class="Token SPACE">      </span><span class="Token ID">Rj</span><span class="Token SPACE">  </span><span class="Token ID">Rk</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Integer</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Mult1</span><span class="Token SPACE">   </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Mult2</span><span class="Token SPACE">   </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Add</span><span class="Token SPACE">     </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Divide</span><span class="Token SPACE">  </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Program ID">register</span><span class="Token SPACE"> </span><span class="Token ID">result</span><span class="Token SPACE"> </span><span class="Token ID">status</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">             </span><span class="Token Program ID">F0</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token ID">F4</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token ID">F8</span><span class="Token SPACE"> </span><span class="Token ID">F10</span><span class="Token LF">
</span><span class="Token SPACE">   </span><span class="Token Program ID">Cycle</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">.</span><span class="Token LF">
</span><span class="Token Program ID">.</span><span class="Token LF">
</span><span class="Token Program ID">.</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token OPTION">----------------------------------------------------------------------</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Program ID">instruction</span><span class="Token SPACE"> </span><span class="Token ID">status</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Op</span><span class="Token SPACE">   </span><span class="Token ID">dest</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token SPACE">   </span><span class="Token ID">k</span><span class="Token SPACE">  </span><span class="Token PIPE">|</span><span class="Token SPACE"> </span><span class="Token Program ID">Issue</span><span class="Token SPACE">  </span><span class="Token ID">Read</span><span class="Token SPACE">  </span><span class="Token ID">Exec</span><span class="Token SPACE">  </span><span class="Token ID">Write</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Load</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE">   </span><span class="Token NUMBER">34</span><span class="Token SPACE">  </span><span class="Token ID">R2</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">     </span><span class="Token NUMBER">1</span><span class="Token SPACE">     </span><span class="Token NUMBER">2</span><span class="Token SPACE">     </span><span class="Token NUMBER">3</span><span class="Token SPACE">     </span><span class="Token NUMBER">4</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Load</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE">   </span><span class="Token NUMBER">45</span><span class="Token SPACE">  </span><span class="Token ID">R3</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">     </span><span class="Token NUMBER">5</span><span class="Token SPACE">     </span><span class="Token NUMBER">6</span><span class="Token SPACE">     </span><span class="Token NUMBER">7</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Mul</span><span class="Token SPACE">  </span><span class="Token ID">F0</span><span class="Token SPACE">   </span><span class="Token ID">F2</span><span class="Token SPACE">  </span><span class="Token ID">F4</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">     </span><span class="Token NUMBER">6</span><span class="Token SPACE">     </span><span class="Token NUMBER">9</span><span class="Token SPACE">    </span><span class="Token NUMBER">19</span><span class="Token SPACE">    </span><span class="Token NUMBER">20</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Sub</span><span class="Token SPACE">  </span><span class="Token ID">F8</span><span class="Token SPACE">   </span><span class="Token ID">F6</span><span class="Token SPACE">  </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">     </span><span class="Token NUMBER">7</span><span class="Token SPACE">     </span><span class="Token NUMBER">9</span><span class="Token SPACE">    </span><span class="Token NUMBER">11</span><span class="Token SPACE">    </span><span class="Token NUMBER">12</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Div</span><span class="Token SPACE">  </span><span class="Token ID">F10</span><span class="Token SPACE">  </span><span class="Token ID">F0</span><span class="Token SPACE">  </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token SPACE">    </span><span class="Token NUMBER">21</span><span class="Token SPACE">    </span><span class="Token NUMBER">61</span><span class="Token SPACE">    </span><span class="Token NUMBER">62</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Add</span><span class="Token SPACE">  </span><span class="Token ID">F6</span><span class="Token SPACE">   </span><span class="Token ID">F8</span><span class="Token SPACE">  </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">    </span><span class="Token NUMBER">13</span><span class="Token SPACE">    </span><span class="Token NUMBER">14</span><span class="Token SPACE">    </span><span class="Token NUMBER">16</span><span class="Token SPACE">    </span><span class="Token NUMBER">22</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Program ID">functional</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token ID">status</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token Program ID">Time</span><span class="Token SPACE">   </span><span class="Token ID">Name</span><span class="Token SPACE">    </span><span class="Token PIPE">|</span><span class="Token SPACE"> </span><span class="Token Program ID">Busy</span><span class="Token SPACE">  </span><span class="Token ID">Op</span><span class="Token SPACE">    </span><span class="Token ID">Fi</span><span class="Token SPACE">  </span><span class="Token ID">Fj</span><span class="Token SPACE">  </span><span class="Token ID">Fk</span><span class="Token SPACE">  </span><span class="Token ID">Qj</span><span class="Token SPACE">      </span><span class="Token ID">Qk</span><span class="Token SPACE">      </span><span class="Token ID">Rj</span><span class="Token SPACE">  </span><span class="Token ID">Rk</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Integer</span><span class="Token SPACE"> </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Mult1</span><span class="Token SPACE">   </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Mult2</span><span class="Token SPACE">   </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Add</span><span class="Token SPACE">     </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token SPACE">           </span><span class="Token Program ID">Divide</span><span class="Token SPACE">  </span><span class="Token PIPE">|</span><span class="Token SPACE">   </span><span class="Token Program ID">No</span><span class="Token SPACE">                                    </span><span class="Token ID">No</span><span class="Token SPACE">  </span><span class="Token ID">No</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token Program ID">register</span><span class="Token SPACE"> </span><span class="Token ID">result</span><span class="Token SPACE"> </span><span class="Token ID">status</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">             </span><span class="Token Program ID">F0</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token ID">F4</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token ID">F8</span><span class="Token SPACE"> </span><span class="Token ID">F10</span><span class="Token LF">
</span><span class="Token SPACE">   </span><span class="Token Program ID">Cycle</span><span class="Token SPACE"> </span><span class="Token NUMBER">62</span></code></pre><p>各功能单元使用情况</p><pre class="language-shell"><code><span class="Token Program ID">Unit</span><span class="Token SPACE">     </span><span class="Token ID">Instruction</span><span class="Token SPACE">     </span><span class="Token ID">start</span><span class="Token SPACE">   </span><span class="Token ID">end</span><span class="Token SPACE">     </span><span class="Token PATH">theoretical/running</span><span class="Token LF">
</span><span class="Token Program ID">Integer</span><span class="Token SPACE">  </span><span class="Token ID">LOAD</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token NUMBER">34</span><span class="Token SPACE"> </span><span class="Token ID">R2</span><span class="Token SPACE">       </span><span class="Token NUMBER">1</span><span class="Token SPACE">     </span><span class="Token NUMBER">4</span><span class="Token SPACE">     </span><span class="Token NUMBER">4</span><span class="Token PATH">/4</span><span class="Token LF">
</span><span class="Token SPACE">         </span><span class="Token Program ID">LOAD</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token NUMBER">45</span><span class="Token SPACE"> </span><span class="Token ID">R3</span><span class="Token SPACE">       </span><span class="Token NUMBER">5</span><span class="Token SPACE">     </span><span class="Token NUMBER">8</span><span class="Token SPACE">     </span><span class="Token NUMBER">4</span><span class="Token PATH">/4</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">Mult1</span><span class="Token SPACE">    </span><span class="Token ID">MUL</span><span class="Token SPACE"> </span><span class="Token ID">F0</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE"> </span><span class="Token ID">F4</span><span class="Token SPACE">        </span><span class="Token NUMBER">6</span><span class="Token SPACE">    </span><span class="Token NUMBER">20</span><span class="Token SPACE">     </span><span class="Token NUMBER">13</span><span class="Token PATH">/15</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">Mult2</span><span class="Token LF">
</span><span class="Token Program ID">Add</span><span class="Token SPACE">      </span><span class="Token ID">SUB</span><span class="Token SPACE"> </span><span class="Token ID">F8</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE">        </span><span class="Token NUMBER">7</span><span class="Token SPACE">    </span><span class="Token NUMBER">12</span><span class="Token SPACE">     </span><span class="Token NUMBER">5</span><span class="Token PATH">/6</span><span class="Token LF">
</span><span class="Token SPACE">         </span><span class="Token Program ID">ADD</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE"> </span><span class="Token ID">F8</span><span class="Token SPACE"> </span><span class="Token ID">F2</span><span class="Token SPACE">       </span><span class="Token NUMBER">13</span><span class="Token SPACE">    </span><span class="Token NUMBER">22</span><span class="Token SPACE">     </span><span class="Token NUMBER">5</span><span class="Token PATH">/10</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token Program ID">Divide</span><span class="Token SPACE">   </span><span class="Token ID">DIV</span><span class="Token SPACE"> </span><span class="Token ID">F10</span><span class="Token SPACE"> </span><span class="Token ID">F0</span><span class="Token SPACE"> </span><span class="Token ID">F6</span><span class="Token SPACE">       </span><span class="Token NUMBER">8</span><span class="Token SPACE">    </span><span class="Token NUMBER">62</span><span class="Token SPACE">     </span><span class="Token NUMBER">43</span><span class="Token PATH">/55</span></code></pre><h2 id="h2-2">ScoreBoard 算法</h2><h3 id="h3-3">背景</h3><blockquote><p>下面先来介绍一下 scoreboard 算法本身, 再来介绍一下笔者的类设计思路和代码运行逻辑</p></blockquote><p>现代的高性能处理器基本都支持多发射和乱序执行,但处理器受到<b>数据冒险</b>的影响并不能轻易地实现乱序,所以业界提出了诸如 scoreboard 算法来控制这个过程</p><p>顺序执行要求指令一条接一条地流过各个流水段, 如果一条指令被阻塞,那么它后面的指令也被阻塞,即使后面的指令完全可以继续运算而不受被阻塞指令的影响.所以聪明的设计师想到要开几条&quot;近道&quot;,好让后面的指令能绕过恰过前面的指令,从而继续执行.</p><blockquote><p>例如当执行需要时间很长的访存指令 lw , 我们不希望下一条无关指令等待 lw 的 cache miss/data miss, 或者不需要等待一条耗时很长的 divide 除法运算</p></blockquote><p>但在传统的五级流水线中,运算通路只有一条,每一条指令都需要依次通过处理器中的 ALU /存储器等部件,这个设定有一个言下之意,<b>就是所有指令都按照一个计算流进行工作</b></p><p>但这不是事实.<b>事实是不同类型的指令有不同的计算要求</b>,前面的例子中 lw 指令需要 ALU 和存储器,<b>但是后面的一连串计算指令不需要访问存储器,所以它们完全可以绕过存储器继续执行,但是因为五级流水线中设计每条指令都要经过存储器,所以后面的计算指令不得不等着 lw 把存储器让出来.</b></p><p>因此, 我们希望</p><ol start="1"><li>每一条指令都可以去<b>选择所需的阶段</b>, 例如 lw 需要全部的 IF ID EX MEM WB 阶段, 但 addi 只需要 IF ID EX WB (即跳过访存 MEM 阶段);</li></ol><ol start="2"><li>与此同时, 计算指令也有各种各样的计算要求以及耗时 (例如浮点数除法的计算周期要远多于普通整数加法计算周期), 加法/乘法/除法指令所需要的计算部件肯定也是不一样的, 我们也期望可以<b>使用不同的计算部件完成对应指令的计算</b></li></ol><p>在五级流水线中只有一个配置,而乱序执行要求,实现&quot;多配置&quot;的流水线处理器, 为各种指令做个性化的配置, 以实现乱序执行.</p><h3 id="h3-4">算法流程</h3><p>scoreboard 其本质是使用一个类似表格的信息存储单元, 通过在指令流水线中为每个指令维护一个&quot;分数牌&quot;(scoreboard),以实现指令的并发执行和解决数据依赖关系.通过分析指令的操作数和状态信息, 动态调度指令的执行</p><p>scoreboard 有两个重要的组成部分, 第一部分是 <b>功能单元状态</b>, 里面的 9 个状态非常关键:</p><ul><li><code>Busy</code>: 单元是否繁忙</li></ul><ul><li><code>Op</code>: 部件执行的指令类型</li></ul><ul><li><code>F_i</code>: 目的寄存器</li></ul><ul><li><code>F_j</code>: 源寄存器</li></ul><ul><li><code>F_k</code>: 源寄存器</li></ul><ul><li><code>Q_j</code>: 如果源寄存器 F_j 不可用, 部件该向哪个功能单元要数据</li></ul><ul><li><code>Q_k</code>: 如果源寄存器 F_k 不可用, 部件该向哪个功能单元要数据</li></ul><ul><li><code>R_j</code>: 源寄存器 F_j 是否可读/需要读</li></ul><ul><li><code>R_k</code>: 源寄存器 F_k 是否可读/需要读</li></ul><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112091956.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112091956.png" alt="20231112091956"></a></p><blockquote><p>现在这里可能有些抽象, 稍后笔者会结合具体的示例做解释</p></blockquote><p>第二部分是 <b>寄存器结果状态</b>. 里面主要记录对于某一个寄存器,是否有功能单元正准备写入数据.</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112091926.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112091926.png" alt="20231112091926"></a></p><blockquote><p>例如上图中 F4 对应 Mult1,这就表明功能模块 Mult1 的计算结果将要写入 F4.</p></blockquote><hr><p>CDC6600 处理器执行分为四个阶段, 即<b>发射(issue), 读取(read), 执行(exec), 写回(write back)</b></p><p>再来看一下我们要执行的指令, 一共六条, 如下所示. 其中的前向数据关联和后向数据关联都以及在图中标记出来了</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112092443.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112092443.png" alt="20231112092443"></a></p><blockquote><p>这几条指令的寄存器关联程度很高, 很适合作为数据冒险的示例来展示 scoreboard 算法的处理方式</p></blockquote><p>计算处理单元有 5 个</p><ul><li>1 个访存单元 Integer (我也不知道为什么要叫 Integer)</li></ul><ul><li>2 个乘法单元 Mult1, Mult2</li></ul><ul><li>1 个加法单元 Add (减法运算也由加法单元执行)</li></ul><ul><li>1 个除法单元 Divide</li></ul><p>下面结合具体实例来说明一下 scoreboard 在各个周期执行的操作以及状态的变化</p><hr><h4 id="h4-5">CLOCK 0</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112135516.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112135516.png" alt="20231112135516"></a></p><p>初始状态如上图所示, 所有指令都未发射, 所有功能单元都空闲, 所有寄存器结果状态为空</p><h4 id="h4-6">CLOCK 1</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112212159.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112212159.png" alt="20231112212159"></a></p><p>每个周期开始都会尝试发射下一条指令, 只要满足三个条件</p><ol start="1"><li><b>如果有指令</b></li></ol><ol start="2"><li><b>有可用的功能单元</b></li></ol><ol start="3"><li><b>指令要写的目的寄存器没有别的指令将要写</b></li></ol><p>CLOCK 1 时三个条件都满足, 因此发射指令 <code>load F6, 34(R2)</code>, 设置 <code>Integer</code> 功能单元 Busy 为 <code>True</code>; Fi 更新为目的寄存器 F6, 同时将 F6 寄存器结果状态标记为 <code>Integer</code> , 表示该功能单元正在使用 F6 寄存器作为目的寄存器</p><p>Fj 是立即数置空即可,  Fk 标记为源寄存器 F2; 此时 R2 R3 两个寄存器<b>都是可读的, 且需要读取的</b>, 所以标记 Rj Rk 为 <code>Yes</code>; 不需要 Qj Qk</p><h4 id="h4-7">CLOCK 2</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112213647.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112213647.png" alt="20231112213647"></a></p><p>CLOCK 2 及之后需要做两件事, <b>首先尝试发射下一条指令, 其次尝试运行所有已发射的指令进入下一个阶段</b></p><p>由于指令2也是load指令需要 Integer 功能单元, 但是该单元已经被指令1占用了, 因此不发射</p><p>指令 1 进入 read 阶段, 读取寄存器 R2 R3 的值</p><blockquote><p>这里分首先和其次是因为发射的条件要确定 <b>指令要写的目的寄存器没有别的指令将要写</b>, 因为已发射的指令有可能以相同的目的寄存器为写回目标. <b>写回需要一个周期</b>去执行, <b>但是发射的瞬间就需要确定当前目的寄存器是可写的</b>, 因此需要 <b>先判断发射条件是否满足</b>, <b>然后再执行</b></p></blockquote><h4 id="h4-8">CLOCK 3</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112214911.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112214911.png" alt="20231112214911"></a></p><p>CLOCK 3 阶段指令 2 依然无法发射, 指令 1 进入 exec 阶段执行, 从对应存储器地址取值. <b>此时更新 Rj Rk 的值为 No</b>, 因为 Rj Rk 既表示 Fj/Fk 寄存器是否可读, <b>也表示是否需要读</b>, 此时经过了 Read 阶段指令 1 就不再需要读取寄存器的值了, 因此置为 No</p><blockquote><p>Time 指的是执行指令所需要的时间, 即 exec 阶段的用时, 默认一般指令用时 1 个周期</p></blockquote><h4 id="h4-9">CLOCK 4</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112215307.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112215307.png" alt="20231112215307"></a></p><p>CLOCK 4 指令完成写回操作, 清空 Integer 功能单元, 置其 Busy 位为 <code>False</code>, 并清空 F6 寄存器结果状态中的 <code>Integer</code> 功能单元</p><h4 id="h4-10">CLOCK 5</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112215410.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112215410.png" alt="20231112215410"></a></p><p>CLOCK 5 发射指令 2, 以相似的方式更新 <code>Integer</code> 功能单元 和 F2 寄存器结果状态</p><h4 id="h4-11">CLOCK 6</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112221424.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112221424.png" alt="20231112221424"></a></p><p>CLOCK 6 尝试做两件事情, 首先尝试发射一条新指令, 此时 <b>有可用的功能单元(mult1)</b> 且 <b>指令要写的目的寄存器(F0)没有别的指令将要写</b>, 因此发射指令 3, 更新 <code>Mult1</code> 功能单元 和 F0 寄存器结果状态</p><p>但此时注意到指令 3 的源寄存器 <code>F2</code> 和 指令 2 的目的寄存器 <code>F2</code> 冲突了, 这是一个经典的<b>写后读(RAW)</b>, 因此 F2 寄存器暂时不可读, 置 Mult1 的 Rj 为 No, <b>并且标记 Qj 为 Integer, 表示只有当 Integer 功能单元执行结束了之后才可以读 F2 寄存器的值</b></p><blockquote><p>或者说从 Integer 功能单元处拿到最新的 F2 的值</p></blockquote><p>指令 2 进入 Read 阶段</p><h4 id="h4-12">CLOCK 7</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112221647.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112221647.png" alt="20231112221647"></a></p><p>CLOCK 7 时指令 4 也满足发射条件, 因此可以发射指令 4, 更新 <code>Add</code> 功能单元 和 F8 结果寄存器状态; 同时也注意到指令 4 的源寄存器 F2 也和指令 2 的目的寄存器 F2 冲突(RAW), 因此设置 Rk 为 No, Qk 为 Integer</p><p>同时指令 2 进入 exec 阶段, 不再需要读寄存器, 置 Rj Rk 为 No</p><blockquote><p>sub 虽然是减法但是也是用 add 加法单元来做的</p></blockquote><h4 id="h4-13">CLOCK 8</h4><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112222142.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112222142.png" alt="20231112222142"></a></p><p>CLOCK 8 再次发射一条新指令 5, 但发现源寄存器 F0 和指令 4 的目的寄存器 F0 冲突了, 所以 Rj 置 No 且 Qj 置 Mult1</p><p>此时指令 2 完成写回操作, <b>即原先被占用的 F2 寄存器的值已经完成更新</b>, 因此原先被卡住的指令3,4 所对应的 <code>Mult1</code> 和 <code>Add</code> 终于可以准备进入下一个阶段, 重新将其 Rj/Rk 置为 Yes 表示可以读了, 然后清空 Qj/Qk 表示其所对应的功能单元已经执行结束, 不再需要等待了</p><h4 id="h4-14">CLOCK 17 &amp; CLOCK 22</h4><p>CLOCK 9 - 16 没有什么要说的, 依然按照之前的流程来做, 相信读者应该已经掌握基本原理了</p><p>需要重点提一下的是 CLOCK 17, 我们先来看一下 CLOCK 16 的情况, 如下图所示</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112223357.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112223357.png" alt="20231112223357"></a></p><p>此时指令 6 对应的 Add 单元刚刚经历了 2 个周期的 exec 阶段, Mult1 还剩下 3 个周期执行, Divide 因为等待来自 Mult1 的 F0 被卡住, 其余指令均已执行完毕</p><p>但是 CLOCK 17 时 Add 并没有写回, 而是卡住, Mult1 继续执行一个周期</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112223853.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112223853.png" alt="20231112223853"></a></p><p><b>这是因为指令 6 的目的寄存器 F6  与 在其前面的指令 5 使用的源寄存器 F6 发生了冲突</b>, 这是一个读后写(WAR). 正常来说读后写是不会遇到问题的(因为只要读出数据之后就随便写), 但是因为乱序执行所以 add 指令优先于 divide 指令执行结束, <b>即指令 5 在读之前, 其后的指令 6 就要写入该寄存器</b></p><p>因此必须等到 CLOCK 21 时 Divide 完成 Read, 将 F6 寄存器的值读取结束之后, 才可以在 CLOCK 22 时将 Add 的 F6 写入</p><p><a data-lightbox="example-1" href="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112224632.png"><img src="https://raw.githubusercontent.com/learner-lu/picbed/master/20231112224632.png" alt="20231112224632"></a></p><h2 id="h2-15">实验报告</h2><h3 id="h3-16">实验分析</h3><p>本次实验相对比较独立, 要求完成 scoreboard 算法的代码实现, 和之前写的流水线代码也没有相关性, 所以基本相当于重写</p><blockquote><p>好在只是要求模拟算法本身的执行流程, 并不要求真正完成计算, <del>不然真好麻烦</del></p></blockquote><h3 id="h3-17">代码实现</h3><p>先来看一下主函数入口, 由于这是一组固定指令序列的模拟, 因此笔者并没有实现完整的指令集以及指令解析, 只是简单定义一些枚举类信息, 将对应的寄存器绑定到指令上.</p><p>值的一提的是这里的 <code>latency</code>, 严格来说延迟指的是除 EX 阶段本身耗时的一个周期之外额外的周期数, 即 latency 为 2 意味着 exec 阶段共需要 3 个周期执行结束, 不过从各方(老师PPT和其他scoreboard文章)来看这里的latency似乎指的是 <b>exec 阶段总共的执行时间</b>, 说实话笔者心里有些存疑, 不过还是按照后者的方式编写的代码实现, 即 latency = 2 意味着需要 2 个周期完成 exec, 默认指令的 latency 为 1</p><pre class="language-python"><code><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">main</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">rg</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">RegisterGroup</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">instructions</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">Op</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">Operation</span><span class="Token DOT">.</span><span class="Token EnumID ID">LOAD</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F6</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">34</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">k</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">R2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">latency</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">1</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">unit_function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">INTEGER</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">Op</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">Operation</span><span class="Token DOT">.</span><span class="Token EnumID ID">LOAD</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">45</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">k</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">R3</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">latency</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">1</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">unit_function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">INTEGER</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">Op</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">Operation</span><span class="Token DOT">.</span><span class="Token EnumID ID">MUL</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F0</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">k</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F4</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">latency</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">10</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">unit_function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">MULT</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">Op</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">Operation</span><span class="Token DOT">.</span><span class="Token EnumID ID">SUB</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F8</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F6</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">k</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">latency</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">unit_function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">ADD</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">Op</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">Operation</span><span class="Token DOT">.</span><span class="Token EnumID ID">DIV</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F10</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F0</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">k</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F6</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">latency</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">40</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">unit_function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">DIVIDE</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">Op</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">Operation</span><span class="Token DOT">.</span><span class="Token EnumID ID">ADD</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F6</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">j</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F8</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">k</span><span class="Token ASSIGN">=</span><span class="Token ID">rg</span><span class="Token DOT">.</span><span class="Token ID">F2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">latency</span><span class="Token ASSIGN">=</span><span class="Token NUMBER">2</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">unit_function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">ADD</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">scoreboard</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">ScoreBoard</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">rg</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">scoreboard</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">load_instructions</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">instructions</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token ID">scoreboard</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">run</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">__name__</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token STR">&quot;__main__&quot;</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token FunctionCall ID">main</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span></code></pre><blockquote><p>这里选择在外侧创建 RegisterGroup 类实例对象并传入 ScoreBoard, 而不是在 ScoreBoard 内部创建主要有两个原因, 第一个是因为希望在指令(Instruction)初始化阶段就完成对于寄存器的绑定, 不然初始化时只能绑定一个字符串 &quot;F6&quot; 然后再在内部匹配对于寄存器, 有一点麻烦. 第二个是因为 ScoreBoard 算法本身只维护<b>功能单元信息</b>和<b>寄存器结果状态</b>, 本身寄存器的值以及其他信息就不应该是 ScoreBoard 类对象创建和维护, 因此选择在外部定义, rg 作为寄存器组对象的引用被传递进 ScoreBoard 类完成初始化</p></blockquote><hr><p><code>run</code> 部分是 ScoreBoard 核心运行流程, 但是在看 run 之前先来看一下 Unit 功能单元的定义</p><p>首先 ScoreBoard 类对象初始化阶段定义的 <code>functional_units</code> 对应 5 个 Unit, 分别绑定对应的功能</p><pre class="language-python"><code><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">ScoreBoard</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">__init__</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">rg</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">RegisterGroup</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token POINT">-&gt;</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">List</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">issued_instructions</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">List</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token INT">int</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">functional_units</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">List</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ClassInstantiation ID">Unit</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ClassInstantiation ID">Unit</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">name</span><span class="Token ASSIGN">=</span><span class="Token STR">&quot;Integer&quot;</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">INTEGER</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ClassInstantiation ID">Unit</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">name</span><span class="Token ASSIGN">=</span><span class="Token STR">&quot;Mult1&quot;</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">MULT</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ClassInstantiation ID">Unit</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">name</span><span class="Token ASSIGN">=</span><span class="Token STR">&quot;Mult2&quot;</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">MULT</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ClassInstantiation ID">Unit</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">name</span><span class="Token ASSIGN">=</span><span class="Token STR">&quot;Add&quot;</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">ADD</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ClassInstantiation ID">Unit</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token ID">name</span><span class="Token ASSIGN">=</span><span class="Token STR">&quot;Divide&quot;</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token ASSIGN">=</span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token DOT">.</span><span class="Token EnumID ID">DIVIDE</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token COMMA">,</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">register_group</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">rg</span></code></pre><p>Unit 内部的 status 表示当前功能单元的状态, 分别对应前文提到的 9 个状态</p><pre class="language-python"><code><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">UnitState</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">__init__</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token POINT">-&gt;</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">Busy</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token BOOL">bool</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 单元是否繁忙</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">Op</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Operation</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 部件执行的指令类型</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">FloatRegister</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 目的寄存器</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">F_j</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">FloatRegister</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 源寄存器</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">F_k</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">FloatRegister</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 源寄存器</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">Q_j</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token STR">&quot;Unit&quot;</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 如果源寄存器 F_j 不可用, 部件该向哪个功能单元要数据</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">Q_k</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token STR">&quot;Unit&quot;</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 如果源寄存器 F_k 不可用, 部件该向哪个功能单元要数据</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token BOOL">bool</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 源寄存器 F_j 是否可读/需要读</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token BOOL">bool</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 源寄存器 F_k 是否可读/需要读</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">Unit</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">__init__</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">name</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token STRR">str</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">UnitFunction</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token POINT">-&gt;</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">name</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">name</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">function</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">function</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">UnitState</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instruction</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">usage_data</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Dict</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ClassInstantiation ID">Instruction</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">List</span><span class="Token BraceDepth-1 LSQUAR_PAREN">[</span><span class="Token INT">int</span><span class="Token BraceDepth-1 RSQUAR_PAREN">]</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LCURLY_BRACE">{</span><span class="Token BraceDepth-0 RCURLY_BRACE">}</span></code></pre><p>接下来回头看一下 ScoreBoard 的运行核心 run 函数, 内部是一个 while 死循环, 只有全部指令都已发射并且所有功能单元都空闲时才退出. 执行流程分为三个阶段</p><ol start="1"><li>尝试发射一条新指令: <b>当有指令 &amp;&amp; 有可用的功能单元 &amp;&amp; 指令要写的目的寄存器没有别的指令将要写</b><p>如果都满足, 则将对应的 unit 绑定到指令, 并将指令放入到 issued_instructions 中</p></li></ol><ol start="2"><li>运行所有已发射的指令(issued_instructions), 由每一条指令内部维护 issue -&gt; read -&gt; exec -&gt; write 的执行顺序</li></ol><ol start="3"><li>在所有指令<b>都执行结束之后一起更新</b> unit 的 Rj Rk Qj Qk 的状态, 因为 write back 阶段回清空目的寄存器, 但是由于前面指令执行的时候使用的是 <code>for</code> 循环串行的调用 <code>issued_instruction.run()</code>, 因此为了避免指令串行更新的干扰在这里统一更新, 解开由于因为目的寄存器和源寄存器读写冲突的 unit</li></ol><pre class="language-python"><code><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">ScoreBoard</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">run</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">show_status</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token GLOBAL">global</span><span class="Token SPACE"> </span><span class="Token EnumID ID">CLOCK</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token EnumID ID">CLOCK</span><span class="Token SPACE"> </span><span class="Token ADD_ASSIGN">+=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">instruction_length</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FunctionCall ID">len</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token WHILE">while</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 当全部指令都已发射并且所有功能单元都空闲时退出</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">instruction_length</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">busy_unit_number</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">functional_units</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Busy</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                        </span><span class="Token ID">busy_unit_number</span><span class="Token SPACE"> </span><span class="Token ADD_ASSIGN">+=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">busy_unit_number</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token BREAK">break</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 尝试发射一条新指令</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 1. 如果有指令</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 2. 并且有可用的功能单元</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 3. 且指令要写的目的寄存器没有别的指令将要写</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 则发射下一条指令</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token SPACE"> </span><span class="Token BANG">!</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">instruction_length</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">has_available_unit</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token BraceDepth-1 LSQUAR_PAREN">[</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token BraceDepth-1 RSQUAR_PAREN">]</span><span class="Token DOT">.</span><span class="Token ID">unit_function</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token IS">is</span><span class="Token SPACE"> </span><span class="Token NOT">not</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE"> </span><span class="Token AND">and</span><span class="Token SPACE"> </span><span class="Token NOT">not</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">has_write_conflict</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token BraceDepth-1 LSQUAR_PAREN">[</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token BraceDepth-1 RSQUAR_PAREN">]</span><span class="Token DOT">.</span><span class="Token ID">dest</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">instruction</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">issued_instructions</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">append</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">instructions</span><span class="Token BraceDepth-1 LSQUAR_PAREN">[</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token BraceDepth-1 RSQUAR_PAREN">]</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">pc</span><span class="Token SPACE"> </span><span class="Token ADD_ASSIGN">+=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 所有指令发射后交由指令本身去执行</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 指令内部维护 issue -&gt; read -&gt; exec -&gt; write 的执行顺序</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">issued_instruction</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">issued_instructions</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">issued_instruction</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">run</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 所有指令都执行结束之后一起更新 unit 的 Rj Rk Qj Qk 的状态, 避免指令串行更新的干扰</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token FOR">for</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token SPACE"> </span><span class="Token IN">in</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">functional_units</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token SPACE"> </span><span class="Token AND">and</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_j</span><span class="Token SPACE"> </span><span class="Token AND">and</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_j</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Busy</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token SPACE"> </span><span class="Token AND">and</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_k</span><span class="Token SPACE"> </span><span class="Token AND">and</span><span class="Token SPACE"> </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_k</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Busy</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">show_status</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token EnumID ID">CLOCK</span><span class="Token SPACE"> </span><span class="Token ADD_ASSIGN">+=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">show_usage_data</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span></code></pre><p>那么关键在于 instruction.run 的实现, 但我们先看一下寄存器(FloatRegister)的定义, 这对理解指令内部执行的代码很有帮助. 其中的三个变量的含义如下</p><ul><li><code>ready_to_be_read</code>: 表示当前寄存器是否可以被读</li></ul><ul><li><code>be_asked_to_read</code>: 表示正在读当前寄存器的 unit 的数量</li></ul><ul><li><code>in_used_unit</code>: 表示正在使用当前寄存器作为目的寄存器的 unit</li></ul><pre class="language-python"><code><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">FloatRegister</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">__init__</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">name</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token STRR">str</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token POINT">-&gt;</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">name</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">name</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">ready_to_be_read</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 当前寄存器是否可以被读</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">be_asked_to_read</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 正在读当前寄存器的 unit 的数量 (用于 WAR) 的判断</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">in_used_unit</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Optional</span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token STR">&quot;Unit&quot;</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span></code></pre><p>指令的执行分为四个阶段:</p><ul><li>如果发现已完成 <code>COMPLETE</code> 则直接返回.</li></ul><ul><li>如果还未发射 <code>TOBE_ISSUE</code> 则进入发射阶段 <code>ISSUE</code>, 并且更新 unit 的状态(update_status)</li></ul><ul><li>如果已发射<ul><li>如果两个源寄存器都可读, 则进入 <code>READ</code> 阶段</li></ul><ul><li>否则卡在这里等待对应的 unit 执行结束</li></ul></li></ul><ul><li>如果在 <code>READ</code> 阶段, 则进入 <code>EXEC</code> 阶段, 完成读取(finish_read)</li></ul><ul><li>如果在 <code>EXEC</code> 阶段, 并且已经执行结束(left_latency == 0), 则说明指令完成 <code>COMPLETE</code></li></ul><pre class="language-python"><code><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">Instruction</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">__init__</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token DOT">.</span><span class="Token DOT">.</span><span class="Token DOT">.</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token POINT">-&gt;</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token DOT">.</span><span class="Token DOT">.</span><span class="Token DOT">.</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Unit</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 执行当前指令的功能单元</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">TOBE_ISSUE</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 指令执行的阶段</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">left_latency</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">latency</span><span class="Token SPACE"> </span><span class="Token COMMENT"># 剩余执行时间</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 LSQUAR_PAREN">[</span><span class="Token BraceDepth-0 RSQUAR_PAREN">]</span><span class="Token SPACE">  </span><span class="Token COMMENT"># 四个阶段进入的时间节点</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">run</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token STR">&quot;&quot;&quot; &quot;&quot;&quot;</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">COMPLETE</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token RETURN">return</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">TOBE_ISSUE</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">ISSUE</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">update_status</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">Op</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">dest</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">j</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">k</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">append</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token EnumID ID">CLOCK</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ELIF">elif</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">ISSUE</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 当两个源寄存器都可读的时候继续</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token SPACE"> </span><span class="Token AND">and</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">READ</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">append</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token EnumID ID">CLOCK</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ELIF">elif</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">READ</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">EXEC</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">finish_read</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">left_latency</span><span class="Token SPACE"> </span><span class="Token SUB_ASSIGN">-=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">left_latency</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">append</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token EnumID ID">CLOCK</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ELIF">elif</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">EXEC</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">left_latency</span><span class="Token SPACE"> </span><span class="Token BraceDepth-0 RANGLE_BRACE">&gt;</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">left_latency</span><span class="Token SPACE"> </span><span class="Token SUB_ASSIGN">-=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">left_latency</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">append</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token EnumID ID">CLOCK</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ELSE">else</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token DOT">.</span><span class="Token ID">be_asked_to_read</span><span class="Token SPACE"> </span><span class="Token BANG">!</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NUMBER">0</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token COMMENT"># WAR hazard</span><span class="Token LF">
</span><span class="Token SPACE">                    </span><span class="Token RETURN">return</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">WRITE</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Busy</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token DOT">.</span><span class="Token ID">in_used_unit</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token DOT">.</span><span class="Token ID">ready_to_be_read</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">InstructionStage</span><span class="Token DOT">.</span><span class="Token EnumID ID">COMPLETE</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span><span class="Token DOT">.</span><span class="Token FunctionCall ID">append</span><span class="Token BraceDepth-1 LPAREN">(</span><span class="Token EnumID ID">CLOCK</span><span class="Token BraceDepth-1 RPAREN">)</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token COMMENT"># 添加统计数据</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">unit</span><span class="Token DOT">.</span><span class="Token ID">usage_data</span><span class="Token BraceDepth-1 LSQUAR_PAREN">[</span><span class="Token ID">self</span><span class="Token BraceDepth-1 RSQUAR_PAREN">]</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">stage_clocks</span></code></pre><p>上述流程中除了表面上的代码还封装了两个位于 unit 中的函数 <code>update_status</code> 和 <code>finish_read</code>. 对于目的寄存器 Fi, 设置其正在被 self(即当前 unit) 占用, 以及作为要被写入的目的寄存器, 暂时不可被读取(ready_to_be_read = False)</p><p>j/k 寄存器如果是立即数单独处理一下, 否则直接更新 Fk Rk Qk 为对应的状态. <b>其中如果源寄存器是可读的(Rj/Rk == True), 则 be_asked_to_read 值加 1, 表示当前寄存器需要被/正在被读取, 用于判断前文提到的 CLOCK 17 CLOCK 22 的读后写问题</b></p><p>finish_read 就是当完成 READ 阶段更新 Rj/Rk 表示不再需要读取源寄存器了, 计数减一</p><pre class="language-python"><code><span class="Token CLASS">class</span><span class="Token SPACE"> </span><span class="Token ClassName ID">Unit</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">update_status</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">Op</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Operation</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">FloatRegister</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">reg_j</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">Union</span><span class="Token BraceDepth-1 LSQUAR_PAREN">[</span><span class="Token INT">int</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">FloatRegister</span><span class="Token BraceDepth-1 RSQUAR_PAREN">]</span><span class="Token COMMA">,</span><span class="Token SPACE"> </span><span class="Token ID">reg_k</span><span class="Token COLON">:</span><span class="Token SPACE"> </span><span class="Token ClassInstantiation ID">FloatRegister</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Busy</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Op</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">Op</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">dest</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token DOT">.</span><span class="Token ID">in_used_unit</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_i</span><span class="Token DOT">.</span><span class="Token ID">ready_to_be_read</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token FunctionCall ID">type</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">reg_j</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token INT">int</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token COMMENT"># 立即数</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token TRUE">True</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ELSE">else</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">reg_j</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">reg_j</span><span class="Token DOT">.</span><span class="Token ID">ready_to_be_read</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">reg_j</span><span class="Token DOT">.</span><span class="Token ID">in_used_unit</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">                </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_j</span><span class="Token DOT">.</span><span class="Token ID">be_asked_to_read</span><span class="Token SPACE"> </span><span class="Token ADD_ASSIGN">+=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">reg_k</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">reg_k</span><span class="Token DOT">.</span><span class="Token ID">ready_to_be_read</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">Q_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token ID">reg_k</span><span class="Token DOT">.</span><span class="Token ID">in_used_unit</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_k</span><span class="Token DOT">.</span><span class="Token ID">be_asked_to_read</span><span class="Token SPACE"> </span><span class="Token ADD_ASSIGN">+=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token LF">
</span><span class="Token SPACE">    </span><span class="Token DEF">def</span><span class="Token SPACE"> </span><span class="Token FunctionName ID">finish_read</span><span class="Token BraceDepth-0 LPAREN">(</span><span class="Token ID">self</span><span class="Token BraceDepth-0 RPAREN">)</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_j</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">R_k</span><span class="Token SPACE"> </span><span class="Token ASSIGN">=</span><span class="Token SPACE"> </span><span class="Token FALSE">False</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token IF">if</span><span class="Token SPACE"> </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_j</span><span class="Token SPACE"> </span><span class="Token IS">is</span><span class="Token SPACE"> </span><span class="Token NOT">not</span><span class="Token SPACE"> </span><span class="Token NONE">None</span><span class="Token COLON">:</span><span class="Token LF">
</span><span class="Token SPACE">            </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_j</span><span class="Token DOT">.</span><span class="Token ID">be_asked_to_read</span><span class="Token SPACE"> </span><span class="Token SUB_ASSIGN">-=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span><span class="Token LF">
</span><span class="Token SPACE">        </span><span class="Token ID">self</span><span class="Token DOT">.</span><span class="Token ID">status</span><span class="Token DOT">.</span><span class="Token ID">F_k</span><span class="Token DOT">.</span><span class="Token ID">be_asked_to_read</span><span class="Token SPACE"> </span><span class="Token SUB_ASSIGN">-=</span><span class="Token SPACE"> </span><span class="Token NUMBER">1</span></code></pre><p>因此最后的写回阶段, 只有当目的寄存器没有被前面发射的指令读的时候才可以写回 (<code>self.unit.status.F_i.be_asked_to_read != 0</code>), 然后做一些收尾的释放</p><p>最后是一些输出格式化之类的比较繁琐的内容</p><h2 id="h2-18">参考</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/496078836" target="_blank">计算机体系结构-记分牌ScoreBoard</a></li></ul></div>
    <div class="dir-tree"><ul><li><a href="../../md-docs/README" >README</a></li></ul><ul><li><a href="../../code/python-riscv" >code</a><ul><li><a href="../../code/python-riscv" >python-riscv</a></li></ul><ul><li><a href="../../code/processor-controllor" >processor-controllor</a></li></ul><ul><li><a href="../../code/pipeline-profiling" >pipeline-profiling</a></li></ul><ul><li><a href="../../code/scoreboard" >scoreboard</a></li></ul><ul><li><a href="../../code/Tomasulo" >Tomasulo</a></li></ul><ul><li><a href="../../code/rob-tom" >rob-tom</a></li></ul><ul><li><a href="../../code/superscale" >superscale</a></li></ul></li></ul><ul><li><a href="../../read/lecture1" >read</a><ul><li><a href="../../read/lecture1" >lecture1</a></li></ul><ul><li><a href="../../read/lecture2" >lecture2</a></li></ul></li></ul></div>
    <div class="zood"><a class="" href="https://github.com/luzhixing12345/zood" target="_blank">zood</a></div>
    <script type="text/javascript" src="../../../js/next_front.js"></script><script>addLink("../../code/pipeline-profiling","../../code/Tomasulo","ab")</script><script type="text/javascript" src="../../../js/change_mode.js"></script><script>addChangeModeButton("../../../img/sun.png","../../../img/moon.png")</script><script type="text/javascript" src="../../../js/copy_code.js"></script><script>addCodeCopy("../../../img/before_copy.png","../../../img/after_copy.png")</script><script type="text/javascript" src="../../../js/navigator.js"></script><script type="text/javascript" src="../../../js/picture_preview.js"></script><script type="text/javascript" src="../../../js/global_js_configuration.js"></script>
</body>

</html>